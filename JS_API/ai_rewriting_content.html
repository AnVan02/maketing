<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Content Rewrite Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<h3>Rewrite nội dung theo block</h3>

<!-- Danh sách block -->
<div id="blocks-container"></div>

<hr>

<!-- Instruction -->
<label><strong>Hướng dẫn chỉnh sửa:</strong></label><br>
<textarea id="instruction" rows="4" style="width: 100%; max-width: 800px;">
Viết lại đoạn này theo phong cách chuyên nghiệp, chuẩn SEO
</textarea>

<br><br>
<button onclick="rewriteContent()">Rewrite nội dung</button>

<hr>

<!-- Kết quả -->
<div id="result"></div>

<script>
/* ===== MOCK DATA: blocks từ backend ===== */
const blocks = [
    {
        id: "p-5",
        tag: "p",
        text: "UI/UX đóng vai trò cực kỳ quan trọng trong thiết kế website hiện đại, giúp nâng cao trải nghiệm người dùng trên mọi tương tác. Khi tối ưu UI/UX, hãy chú ý đến bố cục hài hòa, màu sắc phù hợp, điều hướng logic, tốc độ phản hồi nhanh để khách truy cập cảm thấy hài lòng, dễ dàng tiếp cận nội dung mong muốn.",
        word_count: 70
    },
    {
        id: "h3-3",
        tag: "h3",
        text: "Thiết kế web responsive & tối ưu SEO",
        word_count: 7
    },
    {
        id: "p-6",
        tag: "p",
        text: "Áp dụng responsive design theo hướng mobile-first đã trở thành tiêu chuẩn để website hiển thị tối ưu trên mọi thiết bị. Bên cạnh đó, tối ưu SEO giúp nâng cao thứ hạng tìm kiếm, tăng lượng truy cập bền vững.",
        word_count: 50
    }
];

/* ===== Render blocks ===== */
const container = document.getElementById("blocks-container");
blocks.forEach(block => {
    const div = document.createElement("div");
    div.style.marginBottom = "10px";

    div.innerHTML = `
        <label>
            <input type="radio" name="selectedBlock" value="${block.id}">
            <strong>${block.tag.toUpperCase()} (${block.word_count} từ)</strong>
        </label>
        <div style="margin-left:20px; padding:5px; border-left:2px solid #ccc;">
            ${block.text}
        </div>
    `;
    container.appendChild(div);
});

/* ===== Rewrite API call ===== */
async function rewriteContent() {
    const selectedRadio = document.querySelector("input[name='selectedBlock']:checked");
    const instruction = document.getElementById("instruction").value.trim();
    const resultDiv = document.getElementById("result");

    if (!selectedRadio) {
        alert("Vui lòng chọn block cần rewrite");
        return;
    }

    if (!instruction) {
        alert("Vui lòng nhập hướng dẫn chỉnh sửa");
        return;
    }

    resultDiv.innerHTML = "<p>Đang xử lý rewrite...</p>";

    try {
        const response = await fetch(
            "https://caiman-warm-swan.ngrok-free.app/api/v1/ai/contents/rewrite",
            {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    blocks: blocks.map(b => ({
                        id: b.id,
                        tag: b.tag,
                        text: b.text
                    })),
                    selected_block_id: selectedRadio.value,
                    instruction: instruction
                })
            }
        );

        const data = await response.json();
        resultDiv.innerHTML = "";

        if (!data.success) {
            resultDiv.innerHTML = `<p style="color:red;">Rewrite thất bại</p>`;
            return;
        }

        resultDiv.innerHTML = `
            <h4>Nội dung sau khi rewrite</h4>
            <div style="padding:10px; border:1px solid #ccc;">
                ${data.rewriting_content}
            </div>
        `;

    } catch (error) {
        resultDiv.innerHTML = `
            <p style="color:red;">Lỗi gọi API: ${error.message}</p>
        `;
    }
}
</script>

</body>
</html>
